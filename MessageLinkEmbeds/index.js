(function(d,o,l,L){"use strict";const U=o.findByName("RowManager"),$=o.findByProps("getAPIBaseURL"),m=o.findByStoreName("ThemeStore"),{getChannel:v}=o.findByStoreName("ChannelStore"),{getGuild:w}=o.findByStoreName("GuildStore"),{resolveSemanticColor:B}=o.findByProps("colors","meta").meta,N=/(?<!<)https?:\/\/(?:\w+\.)?discord(?:app)?\.com\/channels\/(\d{17,20}|@me)\/(\d{17,20})\/(\d{17,20})/g,i=new Map,h=[];let c,u;const P=vendetta.patcher.after("generate",U.prototype,function(t,a){let[r]=t;if(r.rowType!==1)return;const p=r?.message?.content;if(!p)return;const b=p.match?.(N)?.map(function(n){const e=n.split("/").slice(-3);return{guildId:e[0]=="@me"?null:e[0],channelId:e[1],messageId:e[2],rawURL:n}});a.message.embeds??=[],b?.forEach(function(n){if(!i.has(n.messageId))return C(n.channelId,n.messageId).then(function(){return E(r.message)});const e=i.get(n.messageId);if(!e)return;const g=`https://cdn.discordapp.com/avatars/${e.author?.id}/${e.author?.avatar}.png`,A=new Date(e.timestamp).toLocaleString([],{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}),s=n.guildId?w(n.guildId):null,f=s?.name,y=s?`https://cdn.discordapp.com/icons/${s.id}/${s.icon}.png`:null,I=v(n.channelId)?.name,R=`${I?"#"+I:""}${f?"  \u2022  "+f:""}`,S=R.length?R:null;a.message.embeds.push({type:"rich",author:{name:`${e.author?.global_name??e.author?.username}  \u2022  ${A}`,url:n.rawURL,iconURL:g,iconProxyURL:g},rawDescription:e.content,description:[{content:e.content,type:"text"}],fields:[],footer:{text:S,iconURL:y,iconProxyURL:y,content:S},bodyTextColor:T()})})}),x=function(){return P()};async function C(t,a){if(i.has(a))return;i.set(a,null);const r=(await $.get({url:`/channels/${t}/messages`,query:{limit:1,around:a},retries:2}).catch(function(){return null}))?.body?.[0];return i.set(a,r),r}function E(t){h.includes(t.id)||(h.push(t.id),l.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...t,content:t.content+"\u200B"},log_edit:!1}))}function T(){return u==m.theme&&c||(u=m.theme,c=l.ReactNative.processColor(B(u,L.semanticColors.TEXT_NORMAL))),c}return d.onUnload=x,d})({},vendetta.metro,vendetta.metro.common,vendetta.ui);
