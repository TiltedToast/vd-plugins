(function(s,r,S,t,z,C,P,$,F){"use strict";const A=r.findByProps("canUseAnimatedEmojis"),B="canUseStickersEverywhere",v="canUseCustomStickersEverywhere",I=A[v]?v:B;function N(){return S.instead(I,A,function(){return!0})}const{getChannel:x}=r.findByStoreName("ChannelStore"),M="https://media.discordapp.net/stickers/{stickerId}.png?size={size}";function L(e,n){if(!e.guild_id)return!0;const a=x(n).guild_id;return e.guild_id==a}function O(e){return M.replace("{stickerId}",e.id).replace("{size}",t.storage.stickerSize.toString())}async function U(e){try{let n=new FormData;n.append("new-image-url",e);let a=await fetch("https://ezgif.com/apng-to-gif",{method:"POST",body:n});const c=a.url.split("/").pop();return n=new FormData,n.append("file",c),n.append("size",t.storage.stickerSize.toString()),a=await fetch(`https://ezgif.com/apng-to-gif/${c}?ajax=true`,{method:"POST",body:n}),`https:${(await a.text()).split('<img src="')[1].split('" style=')[0]}`}catch(n){return C.logger.error(`Failed to convert ${e} to GIF: `,n),null}}const f=new Map;function V(e,n){f.set(e,n),setTimeout(function(){return f.delete(e)},18e5)}function D(e){return f.get(e)}const{openAlert:_}=r.findByProps("openAlert","dismissAlert"),{AlertModal:w,AlertActionButton:d}=r.findByProps("AlertModal","AlertActions"),{Stack:j}=r.findByProps("Stack");function b(e){w&&d?H(e):P.showConfirmationAlert(e)}function H(e){let{title:n,content:a,confirmText:c,cancelText:m,onConfirm:p}=e;_(`vdarnfg-${n?.toLowerCase?.().replaceAll?.(" ","-")}`,React.createElement(w,{title:n,content:a,actions:React.createElement(j,null,React.createElement(d,{text:c,variant:"primary",onPress:p}),m?React.createElement(d,{text:m,variant:"secondary"}):React.createElement(React.Fragment,null))}))}function K(e){b({title:"APNG Sticker",content:`This sticker will be converted to a GIF using Ezgif and an Ezgif link will be sent in chat.
Do you want to continue?`,confirmText:"Continue",cancelText:"Cancel",onConfirm:e})}function q(e){b({title:"APNG conversion failed",content:[(e?"Instead of an animated GIF, raw APNG sticker will be sent in chat":"No stickers will be sent in chat")+", you can customize this behavior in plugin settings.","","Check debug logs for more information about the error."].join(`
`),confirmText:"OK"})}const R=r.findByProps("sendMessage","receiveMessage"),{getStickerById:J}=r.findByStoreName("StickersStore");function Q(){return S.instead("sendStickers",R,function(e,n){const[a,c,m,p]=e,k=c.map(function(i){return J(i)}).filter(function(i){return!L(i,a)});if(!k.length)return n(...e);const G=async function(i){i&&(t.storage.ackedApng=!0);for(const u of k){let o=O(u);if(u.format_type===2&&t.storage.convertApng){let h=D(o);if(!h){z.showToast("Converting APNG sticker to GIF..");const y=await U(o);if(y)V(o,y);else if(q(t.storage.staticApngOnFail),!t.storage.staticApngOnFail)continue;h=y}o=h??o}t.storage.hyperlink&&u.name&&(o=`[${u.name}](${o})`),R.sendMessage(a,{content:o},null,p)}};k.find(function(i){return i.format_type==2})&&!t.storage.ackedApng?K(function(){return G(!0)}):G()})}const{Stack:W,TableRadioGroup:X,TableRadioRow:Y,TableSwitchRow:l,TableRowGroup:E}=r.findByProps("TableRow","TableRowGroup"),{ScrollView:Z}=F.General,ee=r.findByName("HelpMessage"),te=[16,32,64,128,160,256,512,1024];t.storage.convertApng??=!0,t.storage.hyperlink??=!0,t.storage.stickerSize??=160;function ne(){return $.useProxy(t.storage),React.createElement(Z,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(W,{style:{paddingVertical:24,paddingHorizontal:12},spacing:24},React.createElement(E,{title:"General"},React.createElement(l,{label:"Hyperlink stickers",description:"Useful when the embed fails \u{1FAE8}",value:t.storage.hyperlink,onValueChange:function(e){return t.storage.hyperlink=e}})),React.createElement(E,{title:"APNG Stickers"},React.createElement(l,{label:"Convert APNG stickers to GIF",subLabel:"This is needed for stickers to be animated (uses Ezgif).",value:t.storage.convertApng,onValueChange:function(e){return t.storage.convertApng=e}}),React.createElement(l,{label:"Send static sticker if APNG conversion fails",value:t.storage.staticApngOnFail,onValueChange:function(e){return t.storage.staticApngOnFail=e}}),React.createElement(l,{label:"Show warning dialog for APNG stickers",subLabel:"This will only appear once",value:!t.storage.ackedApng,onValueChange:function(e){return t.storage.ackedApng=!e}})),React.createElement(X,{title:"Stickers Size",value:t.storage.stickerSize.toString(),onChange:function(e){return t.storage.stickerSize=parseInt(e)}},te.map(function(e){return React.createElement(Y,{label:e.toString(),subLabel:e==160?"Default":null,key:e.toString(),value:e.toString()})})),React.createElement(ee,{messageType:0},"Stickers size option does not work consistently at the moment.")))}let g;const ae=function(){g&&T(),g=[N(),Q()]},T=function(){return g?.forEach?.(function(e){return e?.()})},re=ne;return s.onLoad=ae,s.onUnload=T,s.settings=re,s})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.toasts,vendetta,vendetta.ui.alerts,vendetta.storage,vendetta.ui.components);
