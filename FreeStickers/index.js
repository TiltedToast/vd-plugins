(function(c,i,g,n,R,U,m,v){"use strict";const{getChannel:b}=i.findByStoreName("ChannelStore"),s="https://media.discordapp.net/stickers/{stickerId}.{extension}?size=160";function E(e,o){if(!e.guild_id)return!0;const t=b(o).guild_id;return e.guild_id==t}function A(e,o){return e.replace("{stickerId}",o.id).replace("{extension}","png")}const{FormInput:L,FormRow:x,FormSection:w,FormSwitchRow:C,FormText:F}=m.Forms,{ScrollView:P}=m.General;n.storage.stickerURL??=s;function T(){return U.useProxy(n.storage),React.createElement(P,null,React.createElement(w,{title:"Sticker URL",titleStyleType:"no_border"},React.createElement(L,{placeholder:s,value:n.storage.stickerURL,onChange:function(e){n.storage.stickerURL=e==""?s:e}}),React.createElement(F,{style:{paddingHorizontal:14}},["URL to use for stickers.","{stickerId} will be replaced with sticker ID","{extension} will be replaced with extension (currently always 'png')"].join(`
`))),React.createElement(w,{title:"Misc"},React.createElement(C,{label:"Show warning dialog for APNG stickers",subLabel:"This will only appear once",value:!n.storage.acknowledgedApng,onValueChange:function(e){n.storage.acknowledgedApng=!e}}),React.createElement(x,{label:"Restore default configuration",onPress:function(){n.storage.stickerURL=s,n.storage.acknowledgedApng=!1,v.showToast("Restored default configuration.")}})))}const k=i.find(function(e){return e.default?.canUseAnimatedEmojis}),l=i.findByProps("sendMessage","receiveMessage"),{getStickerById:z}=i.findByStoreName("StickersStore"),p="canUseStickersEverywhere",I="canUseCustomStickersEverywhere",_=k?.default[p]?p:I;async function M(e,o){let t=new FormData;t.append("new-image-url",e);let r=await fetch("https://ezgif.com/apng-to-gif",{method:"POST",body:t}),d=r.url.split("/").pop();t=new FormData,t.append("file",d),t.append("size","160"),r=await fetch(`https://ezgif.com/apng-to-gif/${d}?ajax=true`,{method:"POST",body:t});let u=`https:${(await r.text()).split('<img src="')[1].split('" style=')[0]}`;l.sendMessage(o,{content:u})}const N=[g.instead(_,k.default,function(){return!0}),g.instead("sendStickers",l,function(e,o){const[t,r,d,u]=e,f=r.map(function(a){return z(a)}).filter(function(a){return!E(a,t)});if(!f.length)return o(...e);const h=async function(a){a&&(n.storage.acknowledgedApng=!0);for(const y of f){const S=A(n.storage.stickerURL,y);y.format_type===2?await M(S,t):l.sendMessage(t,{content:S},null,u)}};f.find(function(a){return a.format_type==2})&&!n.storage.acknowledgedApng?R.showConfirmationAlert({title:"APNG Stickers",content:"APNG stickers will be converted to GIF using Ezgif and an Ezgif link will be sent in chat. Do you want to continue?",confirmText:"Continue",cancelText:"Cancel",onConfirm:function(){h(!0)}}):h()})],G=T,B=function(){return N.forEach(function(e){return e?.()})};return c.onUnload=B,c.settings=G,c})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.alerts,vendetta.storage,vendetta.ui.components,vendetta.ui.toasts);
