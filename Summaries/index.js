(function(d,c,m,i,h,a,p,f,S){"use strict";const{Stack:y,TableRowGroup:E,TextInput:R}=i.findByProps("Stack","TableRowGroup"),{ScrollView:_}=S.General;a.storage.guildWhitelist??="";function v(){return f.useProxy(a.storage),React.createElement(_,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(y,{style:{paddingVertical:24,paddingHorizontal:12},spacing:24},React.createElement(E,{title:"Server whitelist"},React.createElement(R,{value:a.storage.guildWhitelist,onChange:function(e){return a.storage.guildWhitelist=e}}))))}const A=i.findByStoreName("ChannelStore"),B=i.findByStoreName("GuildStore"),C=i.findByStoreName("SelectedChannelStore"),{allSummaries:$}=i.findByProps("allSummaries"),{sendBotMessage:w}=i.findByProps("sendBotMessage"),I=(a.storage.guildWhitelist??"").split(","),r=[],u=[];function g(e){const t=C.getChannelId();r.includes(t)||(c.logger.log(`Adding selected channel ${t} to whitelist`),r.push(t)),e.forEach(function(s){let[n,P]=s;P.forEach(function(o){if(u.includes(o.id))return;u.push(o.id),c.logger.log("Found new summary: ",o);const l=A.getChannel(n);(I.includes(l.guild_id)||r.includes(l.id))&&T(l,o)})})}function T(e,t){const s=B.getGuild(e.guild_id);p.showToast(`${s.name} > #${e.name}: ${t.topic}`),w(e.id,[`## ${t.topic}`,t.summShort,`### [Jump to beginning](https://discord.com/channels/${e.guild_id}/${e.id}/${t.startId})`,"","-# Automated message by Summaries plugin"].join(`
`))}const M=m.before("dispatch",h.FluxDispatcher,function(e){let[t]=e;if(t.type!=="CONVERSATION_SUMMARY_UPDATE")return;c.logger.log("Received CONVERSATION_SUMMARY_UPDATE dispatch: ",t);const s=t.summaries?.map?.(function(n){return{id:n.id,topic:n.topic,summShort:n.summ_short,startId:n.start_id,endId:n.end_id}});s&&g([[t.channel_id,s]])});g(Object.entries($()));const N=M,b=v;return d.settings=b,d.unpatch=N,d})({},vendetta,vendetta.patcher,vendetta.metro,vendetta.metro.common,vendetta.plugin,vendetta.ui.toasts,vendetta.storage,vendetta.ui.components);
