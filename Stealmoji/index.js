(function(v,o,f,m,r,g,S,x,B){"use strict";const L=r.findByProps("convertSurrogateToName"),l=r.findByProps("hideActionSheet"),C=r.findByProps("openMediaModal"),D=r.findByProps("uploadEmoji"),_=r.findByProps("ActionSheet")?.ActionSheet??r.find(function(t){return t.render?.name==="ActionSheet"}),{ActionSheetTitleHeader:z,ActionSheetCloseButton:G}=r.findByProps("ActionSheetTitleHeader"),{BottomSheetFlatList:F}=r.findByProps("BottomSheetScrollView"),k=r.findByStoreName("EmojiStore"),U=r.findByStoreName("GuildStore"),O=r.findByStoreName("PermissionStore"),{default:H,GuildIconSizes:V}=r.findByProps("GuildIconSizes"),{downloadMediaAsset:X}=r.findByProps("downloadMediaAsset");function q(t){return new Promise(function(e,n){o.ReactNative.Image.getSize(t,function(i,a){e([i,a])},n)})}async function J(t){const[e,n]=await q(t),{width:i,height:a}=o.ReactNative.Dimensions.get("window");l.hideActionSheet(),C.openMediaModal({initialSources:[{uri:t,sourceURI:t,width:e,height:n}],initialIndex:0,originLayout:{width:128,height:128,x:i/2-64,y:a-64,resizeMode:"fill"}})}function j(t,e){fetch(t).then(function(n){n.blob().then(function(i){const a=new FileReader;a.readAsDataURL(i),a.onloadend=function(){e(a.result)}})})}const{FormRow:K,FormIcon:Q}=m.Forms;function W(t){let{guild:e,emojiNode:n}=t;const i=function(){x.showInputAlert({title:"Emoji name",initialValue:n.alt,placeholder:"bleh",onConfirm:function(c){j(n.src,function(s){D.uploadEmoji({guildId:e.id,image:s,name:c,roles:void 0}).then(function(){S.showToast(`Added ${n.alt} ${n.alt!==c?`as ${c} `:""}to ${e.name}`,g.getAssetIDByName("Check"))}).catch(function(u){S.showToast(u.body.message,g.getAssetIDByName("Small"))})})},confirmText:`Add to ${e.name}`,confirmColor:void 0,cancelText:"Cancel"}),l.hideActionSheet()},a=e.getMaxEmojiSlots?o.React.useMemo(function(){const c=e.getMaxEmojiSlots(),s=k.getGuilds()[e.id]?.emojis??[],u=n.src.includes(".gif");return s.filter(function(E){return E?.animated===u}).length<c},[]):!0;return o.React.createElement(K,{leading:o.React.createElement(H,{guild:e,size:V.MEDIUM,animate:!1}),disabled:!a,label:e.name,subLabel:a?void 0:"No slots available",trailing:o.React.createElement(Q,{style:{opacity:1},source:g.getAssetIDByName("ic_add_24px")}),onPress:i})}const{FormDivider:Y,FormIcon:Z}=m.Forms;function ee(t){const e=React.createElement(_,{scrollable:!0},React.createElement(m.ErrorBoundary,null,React.createElement(te,{emojiNode:t})));l.openLazy(Promise.resolve({default:function(){return e}}),"AddToServerActionSheet")}function te(t){let{emojiNode:e}=t;const n=Object.values(U.getGuilds()).filter(function(i){return O.can(o.constants.Permissions.MANAGE_GUILD_EXPRESSIONS,i)});return React.createElement(React.Fragment,null,React.createElement(z,{title:`Stealing ${e.alt}`,leading:React.createElement(Z,{style:{marginRight:12,opacity:1},source:{uri:e.src},disableColor:!0}),trailing:React.createElement(G,{onPress:function(){return l.hideActionSheet()}})}),React.createElement(F,{style:{flex:1},contentContainerStyle:{paddingBottom:24},data:n,renderItem:function(i){let{item:a}=i;return React.createElement(W,{guild:a,emojiNode:e})},ItemSeparatorComponent:Y,keyExtractor:function(i){return i.id}}))}const{Button:N}=r.findByProps("TableRow","Button");function w(t){let{emojiNode:e}=t;const n=[{text:"Add to Server",callback:function(){return ee(e)}},{text:"Copy URL to clipboard",callback:function(){o.clipboard.setString(e.src),l.hideActionSheet(),S.showToast(`Copied ${e.alt}'s URL to clipboard`,g.getAssetIDByName("ic_copy_message_link"))}},...o.ReactNative.Platform.select({ios:[{text:"Copy image to clipboard",callback:function(){return j(e.src,function(i){o.clipboard.setImage(i.split(",")[1]),l.hideActionSheet(),S.showToast(`Copied ${e.alt}'s image to clipboard`,g.getAssetIDByName("ic_message_copy"))})}}],default:[]}),{text:`Save image to ${o.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,callback:function(){X(e.src,e.src.includes(".gif")?1:0),l.hideActionSheet(),S.showToast(`Saved ${e.alt}'s image to ${o.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,g.getAssetIDByName("toast_image_saved"))}}];return React.createElement(React.Fragment,null,n.map(function(i){let{text:a,callback:c}=i;return React.createElement(N,{color:N.Colors?.BRAND,text:a,size:N.Sizes?.SMALL,onPress:c,style:{marginTop:o.ReactNative.Platform.select({android:12,default:16})}})}))}const{TouchableOpacity:ne}=m.General,M=r.findByProps("GuildDetails");function ie(){if(M)return T("default",M);const t=[],e=f.before("openLazy",l,function(n){let[i,a]=n;a==="MessageEmojiActionSheet"&&(e(),i.then(function(c){t.push(f.after("default",c,function(s,u){t.push(T("type",u,!0))}))}))});return function(){return e(),t.forEach(function(n){return n?.()})}}function T(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=f.after(t,e,function(a,c){let[{emojiNode:s}]=a;if(o.React.useEffect(function(){return function(){return void(n&&i())}},[]),!s.src)return;const u=c?.props?.children?.props?.children;if(!u)return;const E=f.after("type",u,function($,y){o.React.useEffect(function(){return E},[]);const I=function(d){return d?.props?.source?.uri},R=B.findInReactTree(y,function(d){return d?.find?.(I)}),h=R?.findIndex?.(I)??-1;h>=0&&(R[h]=o.React.createElement(ne,{onPress:function(){return J(s.src.split("?")[0])}},R[h]));const A=function(d){return d?.type?.name==="Button"},b=B.findInReactTree(y,function(d){return d?.find?.(A)}),p=b?.findLastIndex?.(A)??-1;p>=0?b.splice(p+1,0,o.React.createElement(w,{emojiNode:s})):y?.props?.children?.push?.(o.React.createElement(w,{emojiNode:s}))})});return i}function oe(t){let e;return function(){return e??=t()}}const ae=oe(function(){const{MessagesHandlers:t}=r.findByProps("MessagesHandlers"),e=new t(function(){});return e.isModalOrActionsheetObstructing=function(){return l.hideActionSheet()},function(n){return e.handleTapEmoji({nativeEvent:{node:n}})}});function re(t){let{id:e,name:n,animated:i}=t;try{ae()(e?{id:e,alt:n,src:`https://cdn.discordapp.com/emojis/${e}.${i?"gif":"webp"}?size=128`}:{content:L.convertSurrogateToName(n),surrogate:n})}catch(a){console.log("Failed to open action sheet",a)}}const{TouchableOpacity:ce}=m.General;function se(){return f.before("openLazy",l,function(t){let[e,n]=t;n=="MessageReactions"&&e.then(function(i){const a=f.after("default",i,function(c,s){o.React.useEffect(function(){return a},[]);const u=f.after("type",s?.props?.children,function(E,$){o.React.useEffect(function(){return u},[]);const y=f.after("type",$?.props?.header,function(I,R){o.React.useEffect(function(){return y},[]);const h=B.findInReactTree(R,function(p){return p?.props?.tabs?.length});if(!h)return;const{tabs:A,onSelect:b}=h.props;h.props.tabs=A.map(function(p){return o.React.createElement(ce,{onPress:function(){return b(p.props.index)},onLongPress:function(){const{emoji:d}=p.props.reaction;re(d)}},p)})})})})})})}let P=[];var le={onLoad:function(){P.push(ie()),P.push(se())},onUnload:function(){for(const t of P)t()}};return v.default=le,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.metro,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.utils);
