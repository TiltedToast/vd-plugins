(function(B,a,f,y,r,m,g,$,P){"use strict";const L=r.findByProps("convertSurrogateToName"),s=r.findByProps("hideActionSheet"),C=r.findByProps("openMediaModal"),D=r.findByProps("uploadEmoji"),_=r.findByProps("ActionSheet")?.ActionSheet??r.find(function(t){return t.render?.name==="ActionSheet"}),{ActionSheetTitleHeader:F,ActionSheetCloseButton:z}=r.findByProps("ActionSheetTitleHeader"),{BottomSheetFlatList:G}=r.findByProps("BottomSheetScrollView"),k=r.findByStoreName("EmojiStore"),U=r.findByStoreName("GuildStore"),O=r.findByStoreName("PermissionStore"),{default:H,GuildIconSizes:V}=r.findByProps("GuildIconSizes"),{downloadMediaAsset:X}=r.findByProps("downloadMediaAsset");function q(t){return new Promise(function(e,n){a.ReactNative.Image.getSize(t,function(o,i){e([o,i])},n)})}async function J(t){const[e,n]=await q(t),{width:o,height:i}=a.ReactNative.Dimensions.get("window");s.hideActionSheet(),C.openMediaModal({initialSources:[{uri:t,sourceURI:t,width:e,height:n}],initialIndex:0,originLayout:{width:128,height:128,x:o/2-64,y:i-64,resizeMode:"fill"}})}function w(t,e){fetch(t).then(function(n){n.blob().then(function(o){const i=new FileReader;i.readAsDataURL(o),i.onloadend=function(){e(i.result)}})})}const K=r.findByProps("getMaxEmojiSlots"),{FormRow:Q,FormIcon:W}=y.Forms;function Y(t){let{guild:e,emojiNode:n}=t;const o=function(){$.showInputAlert({title:"Emoji name",initialValue:n.alt,placeholder:"bleh",onConfirm:function(c){w(n.src,function(l){D.uploadEmoji({guildId:e.id,image:l,name:c,roles:void 0}).then(function(){g.showToast(`Added ${n.alt} ${n.alt!==c?`as ${c} `:""}to ${e.name}`,m.getAssetIDByName("Check"))}).catch(function(S){g.showToast(S.body.message,m.getAssetIDByName("Small"))})})},confirmText:`Add to ${e.name}`,confirmColor:void 0,cancelText:"Cancel"}),s.hideActionSheet()};let i=!1;const u=a.React.useMemo(function(){let c=e.getMaxEmojiSlots?.()??K?.getMaxEmojiSlots?.(e);c||(i||(i=!0,g.showToast("Failed to check max emoji slots")),c=250);const l=k.getGuilds()[e.id]?.emojis??[],S=n.src.includes(".gif");return l.filter(function(A){return A?.animated===S}).length<c},[]);return a.React.createElement(Q,{leading:a.React.createElement(H,{guild:e,size:V.MEDIUM,animate:!1}),disabled:!u,label:e.name,subLabel:u?i?"Failed to check max emoji slots":void 0:"No slots available",trailing:a.React.createElement(W,{style:{opacity:1},source:m.getAssetIDByName("ic_add_24px")}),onPress:o})}const{FormDivider:Z,FormIcon:ee}=y.Forms;function te(t){const e=React.createElement(_,{scrollable:!0},React.createElement(y.ErrorBoundary,null,React.createElement(ne,{emojiNode:t})));s.openLazy(Promise.resolve({default:function(){return e}}),"AddToServerActionSheet")}function ne(t){let{emojiNode:e}=t;const n=Object.values(U.getGuilds()).filter(function(o){return O.can(a.constants.Permissions.MANAGE_GUILD_EXPRESSIONS,o)}).sort(function(o,i){return o.name?.localeCompare?.(i.name)});return React.createElement(React.Fragment,null,React.createElement(F,{title:`Stealing ${e.alt}`,leading:React.createElement(ee,{style:{marginRight:12,opacity:1},source:{uri:e.src},disableColor:!0}),trailing:React.createElement(z,{onPress:function(){return s.hideActionSheet()}})}),React.createElement(G,{style:{flex:1},contentContainerStyle:{paddingBottom:24},data:n,renderItem:function(o){let{item:i}=o;return React.createElement(Y,{guild:i,emojiNode:e})},ItemSeparatorComponent:Z,keyExtractor:function(o){return o.id}}))}const{Button:N}=r.findByProps("TableRow","Button");function M(t){let{emojiNode:e}=t;const n=[{text:"Add to Server",callback:function(){return te(e)}},{text:"Copy URL to clipboard",callback:function(){a.clipboard.setString(e.src),s.hideActionSheet(),g.showToast(`Copied ${e.alt}'s URL to clipboard`,m.getAssetIDByName("ic_copy_message_link"))}},...a.ReactNative.Platform.select({ios:[{text:"Copy image to clipboard",callback:function(){return w(e.src,function(o){a.clipboard.setImage(o.split(",")[1]),s.hideActionSheet(),g.showToast(`Copied ${e.alt}'s image to clipboard`,m.getAssetIDByName("ic_message_copy"))})}}],default:[]}),{text:`Save image to ${a.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,callback:function(){X(e.src,e.src.includes(".gif")?1:0),s.hideActionSheet(),g.showToast(`Saved ${e.alt}'s image to ${a.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,m.getAssetIDByName("toast_image_saved"))}}];return React.createElement(React.Fragment,null,n.map(function(o){let{text:i,callback:u}=o;return React.createElement(N,{color:N.Colors?.BRAND,text:i,size:N.Sizes?.SMALL,onPress:u,style:{marginTop:a.ReactNative.Platform.select({android:12,default:16})}})}))}const{TouchableOpacity:oe}=y.General,T=r.findByProps("GuildDetails");function ie(){if(T)return x("default",T);const t=[],e=f.before("openLazy",s,function(n){let[o,i]=n;i==="MessageEmojiActionSheet"&&(e(),o.then(function(u){t.push(f.after("default",u,function(c,l){t.push(x("type",l,!0))}))}))});return function(){return e(),t.forEach(function(n){return n?.()})}}function x(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const o=f.after(t,e,function(i,u){let[{emojiNode:c}]=i;if(a.React.useEffect(function(){return function(){return void(n&&o())}},[]),!c.src)return;const l=u?.props?.children?.props?.children;if(!l)return;const S=f.after("type",l,function(A,R){a.React.useEffect(function(){return S},[]);const I=function(d){return d?.props?.source?.uri},E=P.findInReactTree(R,function(d){return d?.find?.(I)}),h=E?.findIndex?.(I)??-1;h>=0&&(E[h]=a.React.createElement(oe,{onPress:function(){return J(c.src.split("?")[0])}},E[h]));const b=function(d){return d?.type?.name==="Button"},v=P.findInReactTree(R,function(d){return d?.find?.(b)}),p=v?.findLastIndex?.(b)??-1;p>=0?v.splice(p+1,0,a.React.createElement(M,{emojiNode:c})):R?.props?.children?.push?.(a.React.createElement(M,{emojiNode:c}))})});return o}function ae(t){let e;return function(){return e??=t()}}const re=ae(function(){const{MessagesHandlers:t}=r.findByProps("MessagesHandlers"),e=new t(function(){});return e.isModalOrActionsheetObstructing=function(){return s.hideActionSheet()},function(n){return e.handleTapEmoji({nativeEvent:{node:n}})}});function ce(t){let{id:e,name:n,animated:o}=t;try{re()(e?{id:e,alt:n,src:`https://cdn.discordapp.com/emojis/${e}.${o?"gif":"webp"}?size=128`}:{content:L.convertSurrogateToName(n),surrogate:n})}catch(i){console.log("Failed to open action sheet",i)}}const{TouchableOpacity:se}=y.General;function le(){return f.before("openLazy",s,function(t){let[e,n]=t;n=="MessageReactions"&&e.then(function(o){const i=f.after("default",o,function(u,c){a.React.useEffect(function(){return i},[]);const l=f.after("type",c?.props?.children,function(S,A){a.React.useEffect(function(){return l},[]);const R=f.after("type",A?.props?.header,function(I,E){a.React.useEffect(function(){return R},[]);const h=P.findInReactTree(E,function(p){return p?.props?.tabs?.length});if(!h)return;const{tabs:b,onSelect:v}=h.props;h.props.tabs=b.map(function(p){return a.React.createElement(se,{onPress:function(){return v(p.props.index)},onLongPress:function(){const{emoji:d}=p.props.reaction;ce(d)}},p)})})})})})})}let j=[];var ue={onLoad:function(){j.push(ie()),j.push(le())},onUnload:function(){for(const t of j)t()}};return B.default=ue,Object.defineProperty(B,"__esModule",{value:!0}),B})({},vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.metro,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.utils);
